---
extends: script
scope: raw
level: error
message: "List items should end with a period or colon (unless it's fewer than three words, a URL, or entirely wrapped in xref/link)."
link: https://github.com/circleci/circleci-docs
script: |
  text := import("text")
  matches := []

  lines := text.split(scope, "\n")

  for i, line in lines {
    trimmed := text.trim_space(line)

    // Check if this is a list item (starts with * or ". ")
    // Note: ". " (dot + space) is an ordered list, ".Title" is a block title
    is_unordered := text.has_prefix(trimmed, "* ")
    is_ordered := text.has_prefix(trimmed, ". ")

    if !is_unordered && !is_ordered {
      continue
    }

    // Remove the list marker
    content := ""
    if is_unordered {
      content = text.trim_space(text.trim_prefix(trimmed, "*"))
    } else {
      content = text.trim_space(text.trim_prefix(trimmed, "."))
    }

    // Skip if line is ONLY an xref or link (navigation items)
    // This means the content starts with xref: or link:
    if text.has_prefix(content, "xref:") || text.has_prefix(content, "link:") {
      continue
    }

    // Count words (split by whitespace)
    words := text.fields(content)

    // Only check items with 3 or more words
    if len(words) < 3 {
      continue
    }

    // Check if ends with period, colon, or forward slash
    // Note: We don't allow ] or ) here because xref/link-only lines are already excluded above
    last_char := content[len(content)-1]
    if last_char == '.' || last_char == ':' || last_char == '/' {
      continue
    }

    // It's a violation
    start := text.index(scope, line)
    matches = append(matches, {begin: start, end: start + len(line)})
  }
